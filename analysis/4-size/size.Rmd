---
title: "Size analysis"
author: "Mike Frank"
date: "November 5, 2014"
output: pdf_document
---

```{r}
setwd("~/Projects/Pragmatics/pragmods/")
rm(list=ls())
source("analysis/helper.R")
source("analysis/useful_dplyr.R")
```

Distractor experiment
----

Done by Benjamin Gittelson

Files (representing three differnet data collection sweeps): 

* pragmods_distractions.results1.tsv
* pragmods_distractions.results2.tsv
* pragmods_distractions.results3.tsv

```{r}
d1 <- read.turk("data/4-size/pragmods_distractions.results1.tsv")
d2 <- read.turk("data/4-size/pragmods_distractions.results2.tsv")
d3 <- read.turk("data/4-size/pragmods_distractions.results3.tsv")

d <- rbind_list(d1,d2,d3) 
```

Merge condition. 

```{r}
conds <- read.csv("data/4-size/scale_and_level.csv")

d <- left_join(d,conds,by="scale_and_levels_condition")
```

Counts and exclusions. Note that this experiment has no manipulation check (Must check whether it has a manipulation check at all!). 

```{r}
d %>% group_by(target.level, objects, features) %>%
  summarise(n=length(workerid), 
            mc.targ = mean(as.numeric(mc.targ, na.rm=TRUE)),
            mc.dist = mean(as.numeric(mc.dist, na.rm=TRUE)))

dc <- d %>% filter(mc.name == "TRUE")

d %>% summarise(n=length(workerid))
dc %>% summarise(n=length(workerid))
```

Now get averages and CIs.

```{r}
ms <- dc %>% 
  group_by(scale_and_levels_condition,targ.features, objects, features) %>%
  summarise(correct = mean(choice == "target"),             
            cih = ci.high(choice == "target"),
            cil = ci.low(choice == "target"))

ms$targ.features <- factor(ms$targ.features)
ms$features <- factor(ms$features)
# pdf("plots/4-size-dists.pdf",width=6, height=3.5)
qplot(targ.features, correct, geom=c("bar","linerange"), stat="identity",
      ymin=correct - cil, ymax=correct + cih, fill=targ.features,
      facets = objects ~ features,
      data=ms) 
# dev.off()
```

Another plot:

```{r}
pdf("plots/4-size-dists.pdf",width=8, height=4)
qplot(objects, correct, geom=c("line","pointrange"), 
      ymin=correct - cil, ymax=correct + cih, col=features,
      position=position_dodge(width=.1),
      data=ms) + facet_grid(.~ targ.features) +
  ylim(c(0,1))
dev.off()
```

Some regression:

```{r}
d$correct <- d$choice == "target"
summary(glm(correct ~ objects * features, 
            data=filter(d, targ.features == 2)))
summary(glm(correct ~ objects + features, 
            data=filter(d, targ.features == 2)))
```